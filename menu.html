<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>All Menu</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    background-color: rgba(30, 60, 114, 0.05); /* biru lembut, transparan */
    padding-bottom: 80px; /* space untuk fixed bar */
  }

  /* ================== Header Restoran ================== */
  .header-resto {
    background: linear-gradient(135deg, #1e3c72, #2a5298);
    color: #fff;
    text-align: center;
    padding: 16px 8px;
  }
  .header-resto img {
    max-height: 60px;
    display: block;
    margin: 0 auto 10px;
  }
  .header-resto h1 {
    margin: 0 0 5px 0;
    font-size: 16px;
  }
  #infoResto {
    font-size: 12px;
    background: rgba(255,255,255,0.1);
    padding: 10px;
    border-radius: 8px;
    display: inline-block;
  }
  #infoResto p {
    margin: 4px 0;
  }

  /* ================== Container Section ================== */
 .container-section {
  max-width: 900px;
  margin: 30px auto;
  padding: 20px 25px;
  background-color: rgba(27, 101, 197, 0.2); /* biru lembut, transparan */
  border-radius: 12px;  /* sudut agak bulat */
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.26); /* shadow tipis biar floating */
  color: #333; /* teks tetap terbaca */
}
  /* ================== Section Titles ================== */
.section-title {
  text-align: center;
  font-weight: bold;
  font-size: 20px;
  margin: 30px 0 20px;
  border-bottom: 2px solid #ccc;
  padding-bottom: 5px;
  display: block;          /* bikin full width */
  width: fit-content;      /* garis bawah hanya selebar teks */
  margin-left: auto;
  margin-right: auto;      /* center horizontal */
}

  /* ================== Promo Grid ================== */
  .promo-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: center;
    margin-bottom: 40px;
  }
  .promo-item {
    background: white;
    border-radius: 8px;
    box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
    width: 275px;
    padding: 10px;
    text-align: center;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .promo-item img {
    width: 100%;
    height: auto;
    object-fit: contain;
    border-radius: 10px;
    margin-bottom: 10px;
  }
  .promo-item h3 { margin: 0 0 6px 0; font-size: 16px; }
  .promo-item p { margin: 0 0 10px 0; font-size: 14px; color: #555; }
  .promo-price { font-weight: bold; color: #28a745; margin-bottom: 8px; }
  .promo-badge {
    position: absolute;
    top: 10px;
    left: 10px;
    background: #ffcc00;
    color: #222;
    font-weight: 800;
    font-size: 13px;
    padding: 4px 10px;
    border-radius: 999px;
    text-transform: uppercase;
    box-shadow: 0 2px 6px rgba(0,0,0,.25);
  }
  .warning { text-align: center; color: #e74c3c; margin: 10px 0; }

  /* ================== Flipbook Gallery ================== */
  .flipbook-gallery {
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    gap: 10px;
    padding: 10px 0;
  }
  .flipbook-gallery img {
    flex-shrink: 0;
    width: 100%;  /* 1 gambar full container */
    max-width: 600px;
    height: auto;
    scroll-snap-align: center;
    border-radius: 10px;
    object-fit: cover;
    cursor: pointer;
    border: 2px solid #ccc;
    transition: transform 0.3s ease, border-color 0.3s ease;
  }
  .flipbook-gallery img:hover {
    border-color: #28a745;
    box-shadow: 0 0 6px rgba(40,167,69,0.5);
    transform: scale(1.02);
  }

  /* ================== Fullscreen Overlay ================== */
  .fullscreen-overlay {
    display: none;
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.85);
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }
  .fullscreen-overlay img {
    max-width: 95vw;
    max-height: 90vh;
    border-radius: 10px;
  }
  .fullscreen-overlay .close-btn {
    position: absolute; top: 20px; right: 30px;
    font-size: 30px; color:#fff; cursor:pointer;
  }
  .fullscreen-overlay .nav-btn {
    position: absolute; top: 50%; transform: translateY(-50%);
    font-size: 40px; color: #fff; cursor:pointer;
    padding: 10px; background: rgba(0,0,0,0.4); border-radius: 50%;
  }
  .fullscreen-overlay .prev-btn { left: 20px; }
  .fullscreen-overlay .next-btn { right: 20px; }

  /* ================== Buttons ================== */
  .btn-book { display:block; margin:20px auto; width:80%; padding:16px; font-size:1.2rem; background:#ffc107; color:#fff; border:none; border-radius:12px; cursor:pointer; transition:0.3s; }
  .btn-book:hover { background:#e0a800; }

  .fixed-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  display: flex;
  justify-content: space-around;
  background: linear-gradient(135deg, #1e3c72, #2a5298);
  border-top: 1px solid #ddd;
  padding: 6px 0;
  z-index: 1000;
}

.nav-btn {
  display: flex;
  flex-direction: column; /* icon di atas, teks di bawah */
  align-items: center;
  justify-content: center;
  background: none;
  border: none;
  outline: none;
  flex: 1;
  cursor: pointer;
  padding: 4px 0;
  font-family: inherit;
  color: #fff; /* üëà warna teks & icon jadi putih */
  transition: color 0.2s ease;
}

.nav-btn:hover {
   color: #facc15;
}

.nav-btn .icon {
  font-size: 22px; /* ukuran icon */
  line-height: 1.2;
}

.nav-btn .label {
  font-size: 12px; /* ukuran teks kecil */
  margin-top: 2px;
}

</style>
</head>
<body>

<!-- Header Restoran -->
<div class="header-resto">
  <img id="logoResto" src="" alt="Logo Restoran" />
  <h1 id="namaRestoDisplay"></h1>
  <div id="infoResto">
    <p id="alamatResto">üìç Address: </p>
    <p id="teleponResto">üìû Telephone: </p>
  </div>
</div>

<!-- Container Utama -->
<div class="container-section">
  <!-- Promo Section -->
  <section class="flipbook-section">
    <h1 class="section-title">üéâ Promo Special</h1>
    <div id="promoContainer" class="promo-grid"></div>
    <div id="promoWarning" class="warning"></div>
  </section>

  <!-- Flipbook Ruangan -->
  <section class="flipbook-section">
    <h1 class="section-title">üì∏ Room Gallery</h1>
    <div style="max-width:600px; margin:0 auto;">
      <div id="flipbookRuanganGallery" class="flipbook-gallery"></div>
    </div>
    <div id="ruanganWarning" class="warning"></div>
  </section>

  <!-- Flipbook Menu -->
  <section class="flipbook-section">
    <h1 class="section-title">üìñ Menu Gallery</h1>
    <div style="max-width:600px; margin:0 auto;">
      <div id="flipbookMenuGallery" class="flipbook-gallery"></div>
    </div>
    <div id="menuWarning" class="warning"></div>
  </section>
</div>

<!-- Fullscreen overlay -->
<div class="fullscreen-overlay" id="fullscreenOverlay">
  <span class="close-btn" onclick="closeFullscreen()">‚úñ</span>
  <span class="nav-btn prev-btn" onclick="showPrev()">‚ü®</span>
  <img id="fullscreenImage" alt="Fullscreen Image" />
  <span class="nav-btn next-btn" onclick="showNext()">‚ü©</span>
</div>

<!-- Fixed Button Bar -->
<div class="fixed-bar">
 <button class="nav-btn" onclick="goToPage('book.html')">
  <span class="icon">üìñ</span>
  <span class="label">Dine-in Book</span>
</button>

<button class="nav-btn" onclick="goToPage('order.html')">
  <span class="icon">üõí</span>
  <span class="label">Reserve & Delivery</span>
</button>

<button class="nav-btn" onclick="goToPage('room.html')">
  <span class="icon">üè¢</span>
  <span class="label">Room & Package</span>
</button>
</div>
  
<script src="./db-core.js"></script>
<script>

async function initDB() {
  if (!window.MENUVA_DB) {
    throw new Error("MENUVA_DB not loaded");
  }

  const db = await window.MENUVA_DB.open();

  // üî• auto reload jika admin upgrade DB
  db.onversionchange = () => {
    console.warn("üîÅ DB version changed ‚Üí reload menu");
    db.close();
    location.reload();
  };

  return db;
}

/* =======================
   RESTO ID
======================= */
function getRestoId() {
  const params = new URLSearchParams(location.search);
  const urlId = params.get("resto");

  if (urlId) {
    localStorage.setItem("restoId", urlId);
    console.log("üîë Resto ID from URL:", urlId);
    return urlId;
  }

  const stored = localStorage.getItem("restoId");
  if (stored) return stored;

  document.body.innerHTML =
    "<h2 style='text-align:center'>Resto tidak ditemukan</h2>";
  return null;
}

async function loadMenuPageData(restoId) {
  const resto = await MENUVA_DB.get("restos", restoId);

  const menu = await MENUVA_DB.getAll("menuData");
  const promo = await MENUVA_DB.getAll("promoData");
  const flipbook = await MENUVA_DB.getAll("flipbookData");

  return {
    resto,
    menu,
    promo,
    flipbookMenu: flipbook.filter(f => f.type === "menu"),
    flipbookRuangan: flipbook.filter(f => f.type === "room")
  };
}


/* =======================
   RENDER
======================= */
function renderHeader(data) {
  const logo = document.getElementById("logoResto");
  if (logo) {
    logo.style.display = data.logo ? "block" : "none";
    if (data.logo) logo.src = data.logo;
  }

  document.getElementById("namaRestoDisplay").textContent =
    data.namaRestoran || "Menu Restoran";

  document.getElementById("alamatResto").innerText =
    `üìç Address: ${data.restoAddress || "-"}`;

  document.getElementById("teleponResto").innerText =
    `üìû Telephone: ${data.restoPhone || "-"}`;
}

/* =======================
   PROMO
======================= */
function renderPromo(list = []) {
  const box = document.getElementById("promoContainer");
  const warn = document.getElementById("promoWarning");

  box.innerHTML = "";
  warn.textContent = "";

  if (!list.length) {
    warn.textContent = "‚ùå No promo available";
    return;
  }

  list.forEach((p, i) => {
    const card = document.createElement("div");
    card.className = "promo-item";

    if (p.kategori) {
      const badge = document.createElement("div");
      badge.className = "promo-badge";
      badge.textContent = p.kategori;
      card.appendChild(badge);
    }

    if (p.image) {
      const img = document.createElement("img");
      img.src = p.image;
      card.appendChild(img);
    }

    card.innerHTML += `
      <h3>${p.namaPromo || "-"}</h3>
      <p>${p.deskripsi || "-"}</p>
      <div class="promo-price">
        ${p.harga ? "Rp " + Number(p.harga).toLocaleString("id-ID") : "-"}
      </div>
    `;

    box.appendChild(card);
  });
}

/* =======================
   FLIPBOOK
======================= */
function renderFlipbookGallery(id, images = [], warnId) {
  const box = document.getElementById(id);
  const warn = document.getElementById(warnId);
  box.innerHTML = "";
  warn.textContent = "";

  if (!images.length) {
    warn.textContent = "No pictures.";
    return;
  }

  images.forEach(src => {
    const img = document.createElement("img");
    img.src = src;
    box.appendChild(img);
  });
}

/* =======================
   WATCHER (SAFE)
======================= */
async function watchDBChanges(restoId) {
  let last = "";

  setInterval(async () => {
    try {
      const data = await loadDataFromDB(restoId);
      if (!data) return;

      const now = JSON.stringify(data);
      if (now !== last) {
        last = now;
        console.log("üîÑ Data updated");

        renderPromo(data.menuPromo || []);
        renderFlipbookGallery(
          "flipbookRuanganGallery",
          data.flipbookRuanganImages || [],
          "ruanganWarning"
        );
        renderFlipbookGallery(
          "flipbookMenuGallery",
          data.flipbookMenuImages || [],
          "menuWarning"
        );
      }
    } catch {}
  }, 5000);
}

/* =======================
   INIT MENU (SIMPLE)
======================= */
async function initMenuPage() {
  console.log("‚ñ∂Ô∏è initMenuPage");

  const restoId = getRestoId();
  if (!restoId) return;

  // üî• ambil data sesuai kontrak DB
  const resto = await MENUVA_DB.get("restos", restoId);
  if (!resto) {
    showFallbackUI("Menu belum tersedia");
    return;
  }

  const promo = await MENUVA_DB.getAll("promoData");
  const flipbook = await MENUVA_DB.getAll("flipbookData");

  // üî• pisahkan flipbook
  const flipbookRuangan = flipbook
    .filter(f => f.type === "room")
    .map(f => f.image);

  const flipbookMenu = flipbook
    .filter(f => f.type === "menu")
    .map(f => f.image);

  // ================= RENDER =================
  renderHeader(resto);
  renderPromo(promo);
  renderFlipbookGallery(
    "flipbookRuanganGallery",
    flipbookRuangan,
    "ruanganWarning"
  );
  renderFlipbookGallery(
    "flipbookMenuGallery",
    flipbookMenu,
    "menuWarning"
  );

  console.log("‚úÖ Menu ready");
}

/* =======================
   START
======================= */
document.addEventListener("DOMContentLoaded", async () => {
  await window.MENUVA_DB.open(); // üî• pastikan schema ready
  initMenuPage();
});


/* =======================
   UTIL
======================= */
function showFallbackUI(msg) {
  document.querySelector(".container-section").innerHTML =
    `<div style="text-align:center;padding:40px">${msg}</div>`;
}

function goToPage(page) {
  const id = localStorage.getItem("restoId");
  location.href = id ? `${page}?resto=${id}` : page;
}
</script>

</body>
</html>


